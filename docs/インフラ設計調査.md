# インフラ設計調査

## 概要

Phase 1 着手前に、デプロイ先・DB・プッシュ通知のインフラ技術選定を確定させるための調査。
ハッカソン用途を前提に、無料枠・セットアップコスト・ハッカソン向き度を中心に比較する。

対象スコープ:
1. デプロイ先（APIサーバー）
2. フロントエンドホスティング
3. DBホスティング
4. プッシュ通知

---

## 1. デプロイ先（APIサーバー）比較

### GCP Cloud Run

**概要**
コンテナイメージをデプロイするサーバーレス実行環境。リクエストが来たときのみ起動し、アイドル時はゼロスケールする。

**無料枠**
- 200万リクエスト/月
- 360,000 GB秒のメモリ / 180,000 vCPU秒

**メリット**
- 無料枠が大きく、ハッカソン規模なら実質無料
- コンテナさえ動けばどんな言語・フレームワークも対応
- GCPコンソールでFCM（プッシュ通知）と同じプロジェクト管理できる
- 自動スケーリング対応

**デメリット**
- コンテナイメージのビルドが必要（Dockerfile作成コストあり）
- コールドスタートが発生する場合あり（数秒程度）

**ハッカソン向き度: ★★★★☆**

---

### AWS ECS Fargate / Elastic Beanstalk

**概要**
AWSのコンテナ実行基盤（ECS Fargate）またはPaaS（Elastic Beanstalk）。

**無料枠**
- ECS Fargate: 無料枠なし（EC2利用で一部無料）
- Elastic Beanstalk: 環境自体は無料（EC2/RDSの料金は別途）

**メリット**
- AWSエコシステムと統合が容易
- 豊富なドキュメントとコミュニティ

**デメリット**
- 設定が多く学習コストが高い
- ECS Fargate は無料枠がなくコストがかかりやすい
- IAMロール・セキュリティグループなどの設定が煩雑

**ハッカソン向き度: ★★☆☆☆**

---

### Render

**概要**
シンプルなPaaSで、GitHubリポジトリからの自動デプロイが容易。

**無料枠**
- 無料プランあり（750時間/月）
- ただし15分間アクセスがないとスリープする

**メリット**
- セットアップが非常に簡単（GitHub連携で数分でデプロイ）
- データベース・Webサービスを同じ画面で管理できる

**デメリット**
- 無料プランはスリープあり（初回リクエストに30秒程度かかる）
- スリープ回避には有料プラン（$7/月〜）が必要

**ハッカソン向き度: ★★★☆☆**（デモ用途なら十分）

---

### Railway

**概要**
デプロイとDBを同梱で管理できるPaaS。設定が少なく素早く立ち上げられる。

**無料枠**
- $5/月分のクレジット（Hobbyプラン $5/月で実質無料）
- 無料トライアルあり（500時間/月、1GB RAM）

**メリット**
- DBとAPIサーバーを同じプロジェクトに同梱できる
- セットアップが非常に簡単
- Dockerfileなしでも動く場合あり（Nixpacksによる自動ビルド）

**デメリット**
- 無料枠はトライアルのみ（長期運用はHobbyプランが必要）
- 大規模向きではない

**ハッカソン向き度: ★★★★☆**

---

### fly.io

**概要**
複数リージョンに対応した軽量コンテナホスティング。

**無料枠**
- 3つの共有CPU・256MB RAMのVMが無料
- 3GBのストレージ

**メリット**
- 安価で複数リージョン対応
- Dockerfileベースで動く
- スリープなし（常時起動）

**デメリット**
- CLIの習熟が必要
- ドキュメントが他サービスより少ない

**ハッカソン向き度: ★★★☆☆**

---

### 比較表（デプロイ先）

| サービス | 無料枠 | スリープ | セットアップ難度 | ハッカソン向き度 |
|---------|--------|---------|--------------|--------------|
| GCP Cloud Run | 200万リクエスト/月 | なし（ゼロスケール） | 中（Dockerfile必要） | ★★★★☆ |
| AWS ECS Fargate | なし | なし | 高 | ★★☆☆☆ |
| Render | 750時間/月 | あり（15分） | 低 | ★★★☆☆ |
| Railway | $5クレジット/月 | なし | 低 | ★★★★☆ |
| fly.io | 3VM無料 | なし | 中 | ★★★☆☆ |

---

## 2. フロントエンドホスティング比較

### Firebase Hosting

**概要**
Google FirebaseのCDNホスティング。SPAやPWAのデプロイに最適化されている。

**無料枠**
- 10GB/月のストレージ
- 360MB/日のデータ転送
- カスタムドメイン対応

**メリット**
- FCM（プッシュ通知）と同じFirebaseプロジェクトで管理できる
- GCP Cloud Runとの統合が容易（同一GCPプロジェクト）
- CLIデプロイが簡単

**デメリット**
- フロントエンドのビルド設定は別途必要

**ハッカソン向き度: ★★★★☆**

---

### AWS Amplify

**概要**
AWSのフルスタックホスティングサービス。CI/CD付き。

**無料枠**
- 12ヶ月間: 15GB/月のストレージ、1000分/月のビルド時間

**メリット**
- CI/CDが自動で組み込まれている
- AWSサービスとの統合が容易

**デメリット**
- AWSエコシステムに依存
- 設定が複雑になりやすい

**ハッカソン向き度: ★★☆☆☆**

---

### Vercel

**概要**
フロントエンドホスティングの定番。特にNext.jsとの相性が良い。

**無料枠**
- 100GBの帯域/月
- 無制限のデプロイ

**メリット**
- セットアップが最も簡単（GitHubリポジトリ連携で即デプロイ）
- CDNが高速
- プレビューデプロイ機能が便利

**デメリット**
- サーバーサイド機能はVercel固有の仕組みが必要

**ハッカソン向き度: ★★★★★**

---

### Netlify

**概要**
シンプルなJAMstackホスティング。

**無料枠**
- 100GBの帯域/月
- 300分/月のビルド時間

**メリット**
- Vercelと同様にセットアップが簡単
- フォーム・関数などの機能も内包

**デメリット**
- Next.jsはVercelに比べると最適化が若干劣る

**ハッカソン向き度: ★★★★☆**

---

### 比較表（フロントエンドホスティング）

| サービス | 無料枠 | セットアップ難度 | CI/CD | ハッカソン向き度 |
|---------|--------|--------------|-------|--------------|
| Firebase Hosting | 10GB/月 | 低 | 要設定 | ★★★★☆ |
| AWS Amplify | 15GB/月（12ヶ月） | 高 | 自動 | ★★☆☆☆ |
| Vercel | 100GB/月 | 最低 | 自動 | ★★★★★ |
| Netlify | 100GB/月 | 最低 | 自動 | ★★★★☆ |

---

## 3. DBホスティング比較

### Supabase

**概要**
PostgreSQLをベースにしたオープンソースのBaaSプラットフォーム。管理UIが充実している。

**無料枠**
- 500MB のDBストレージ
- 5GBの帯域
- 50,000 MAU（認証機能利用時）

**接続方法**
- 直接TCP接続（PostgreSQL標準の5432ポート）
- Connection Pooling（PgBouncer経由, 6543ポート）
- REST API（PostgREST）

**メリット**
- 管理UIが非常に使いやすい（テーブル確認・クエリ実行が容易）
- 認証・ストレージなどのBaaS機能も利用可能
- オープンソースで自己ホスティングも可能
- GCP/AWS問わず利用できる

**注意点**
- 無料プロジェクトは7日間アクティビティなしで一時停止される
- 再開は手動でダッシュボードから操作が必要

**ハッカソン向き度: ★★★★★**

---

### Neon

**概要**
サーバーレスアーキテクチャのPostgreSQL。ブランチ機能が特徴。

**無料枠**
- 0.5GBのストレージ
- 190時間/月のコンピュート

**接続方法**
- 通常のPostgreSQL接続文字列
- サーバーレスドライバー（WebSocket経由）

**メリット**
- サーバーレスで自動スケーリング
- ブランチ機能で開発・本番環境を分けやすい
- コールドスタートが速い

**注意点**
- 無料枠のコンピュート時間に上限あり
- アイドル時はサスペンドされる（再起動に数秒かかる場合あり）

**ハッカソン向き度: ★★★★☆**

---

### Railway PostgreSQL

**概要**
RailwayのAPIサーバーと同じプロジェクト内でPostgreSQLを立ち上げる。

**無料枠**
- RailwayのHobbyプラン（$5/月）に含まれる
- 1GBのストレージ

**接続方法**
- Railway内部ネットワーク経由（同じプロジェクト内なら追加設定不要）

**メリット**
- APIサーバーとDBを同じ画面で管理できる
- 内部ネットワークで接続するため設定が簡単

**注意点**
- Railway以外のデプロイ先からの接続はパブリックURLが必要

**ハッカソン向き度: ★★★☆☆**（Railwayをデプロイ先にする場合のみ推奨）

---

### Cloud SQL（GCP）

**概要**
GCPのフルマネージドRDBMS。PostgreSQL・MySQL・SQL Serverに対応。

**無料枠**
- 無料枠なし（最低 $7〜15/月程度）

**接続方法**
- Cloud SQL Auth Proxy
- 直接IP接続（パブリックIP許可設定が必要）

**メリット**
- Cloud Runとの統合が容易（同一VPC内で接続可能）
- フルマネージドで運用が楽

**注意点**
- 無料枠がないためコストが発生する
- ハッカソン規模ではオーバースペック

**ハッカソン向き度: ★★☆☆☆**

---

### RDS（AWS）

**概要**
AWSのフルマネージドRDBMS。

**無料枠**
- 12ヶ月間: db.t3.microインスタンス 750時間/月（無料利用枠）

**接続方法**
- VPC内からの直接接続
- パブリックアクセス設定

**メリット**
- AWSエコシステムとの統合が良好
- 12ヶ月間の無料枠がある

**注意点**
- 設定が複雑（VPC・セキュリティグループ・サブネット等）
- 12ヶ月以降は有料（$25/月〜）

**ハッカソン向き度: ★★☆☆☆**

---

### 比較表（DBホスティング）

| サービス | 無料枠 | セットアップ難度 | 管理UI | ハッカソン向き度 |
|---------|--------|--------------|-------|--------------|
| Supabase | 500MB | 低 | 充実 | ★★★★★ |
| Neon | 0.5GB | 低 | 普通 | ★★★★☆ |
| Railway PostgreSQL | 1GB（Hobbyプラン） | 最低 | 普通 | ★★★☆☆ |
| Cloud SQL (GCP) | なし | 中 | 充実 | ★★☆☆☆ |
| RDS (AWS) | 750時間/月（12ヶ月） | 高 | 充実 | ★★☆☆☆ |

---

## 4. プッシュ通知比較

### FCM（Firebase Cloud Messaging）

**概要**
Googleが提供するプッシュ通知サービス。iOS・Android・Webの全プラットフォームに対応したデファクトスタンダード。

**無料枠**
- 完全無料（送信数制限なし）

**メリット**
- iOS・Android・Web全対応
- 完全無料
- デファクトスタンダードで情報が豊富
- Firebaseプロジェクトに紐づくため、GCPと統合管理しやすい
- GCP/AWS問わず利用できる（FirebaseプロジェクトはGCP/AWSどちらのバックエンドからでも使える）

**注意点**
- iOSはAPNs経由のため、Apple Developer Programへの登録が必要
- FCMトークンの管理が必要（デバイスごとにトークンを発行・保存）

**ハッカソン向き度: ★★★★★**

---

### AWS SNS（Simple Notification Service）

**概要**
AWSのマネージド通知サービス。FCMやAPNsへのプロキシとして機能する。

**無料枠**
- 100万件のモバイルプッシュ通知/月（無料）

**メリット**
- AWSエコシステムとの統合が良好
- メール・SMS・HTTPなど多様な通知方法に対応

**デメリット**
- FCMとAPNsの両方の認証情報をSNSに設定する必要あり（二重管理）
- FCMを直接使うより設定が増える
- AWSを使わない構成では不要

**ハッカソン向き度: ★★☆☆☆**

---

### APNs直接（Apple Push Notification service）

**概要**
Appleが提供するiOS向けプッシュ通知の基盤。FCMもiOSへの通知にはAPNsを経由している。

**無料枠**
- 完全無料

**メリット**
- 中間サービス不要でiOSに直接送信できる

**デメリット**
- iOSのみ対応（Androidには対応不可）
- 証明書またはキーの管理が必要
- p8キーファイルの安全な管理が必要
- FCMを使えば自動的にAPNsへルーティングされるため、直接使う必要がほぼない

**ハッカソン向き度: ★☆☆☆☆**（FCMで代替可能）

---

### 比較表（プッシュ通知）

| サービス | 無料枠 | iOS対応 | Android対応 | セットアップ難度 | ハッカソン向き度 |
|---------|--------|--------|------------|--------------|--------------|
| FCM | 無制限 | ○（APNs経由） | ○（直接） | 低 | ★★★★★ |
| AWS SNS | 100万件/月 | ○（FCM/APNs経由） | ○（FCM経由） | 中 | ★★☆☆☆ |
| APNs直接 | 無制限 | ○ | ✗ | 中 | ★☆☆☆☆ |

---

## 5. 推奨の組み合わせ候補

### Option A: GCP 完結型

| 役割 | サービス |
|------|---------|
| APIサーバー | GCP Cloud Run |
| フロントエンド | Firebase Hosting |
| DB | Supabase |
| プッシュ通知 | FCM |

**特徴**
- GCP/Firebaseで統合管理できるため、FCMの設定が自然に集まる
- Cloud Runの無料枠（月200万リクエスト）がハッカソン規模には十分
- Firebase HostingとCloud RunはGCPの同一プロジェクトで管理できる
- Supabaseはクラウドサービスに依存しないため、GCPとの組み合わせでも問題なし

**向いている場面**: GCPの知識がある・FCMの設定を一元管理したい

---

### Option B: AWS 完結型

| 役割 | サービス |
|------|---------|
| APIサーバー | ECS Fargate or Elastic Beanstalk |
| フロントエンド | AWS Amplify |
| DB | Supabase |
| プッシュ通知 | FCM（GCP/AWSに関係なく利用可能） |

**特徴**
- AWSエコシステムで統一できる
- 設定が多く学習コストが高め
- ハッカソン向きとは言いにくい（ECS Fargateの無料枠がないため）

**向いている場面**: AWSの知識が豊富・将来的なAWSへの移行を見据えている

---

### Option C: シンプル構成（ハッカソン最速）

| 役割 | サービス |
|------|---------|
| APIサーバー | Render |
| フロントエンド | Vercel or Netlify |
| DB | Supabase |
| プッシュ通知 | FCM |

**特徴**
- 設定コスト最小でデモまでの時間が最短
- Vercel/Netlifyは数分でデプロイ可能
- Supabaseも無料登録で即利用可能
- Renderのスリープ問題はあるが、デモ用途なら許容範囲

**向いている場面**: 開発速度を最優先にしたい・インフラに時間をかけたくない

---

### 総合推奨

ハッカソン用途では **Option A（GCP 完結型）** または **Option C（シンプル構成）** を推奨する。

- **GCPの経験があるチーム** → Option A（Cloud Run + Firebase Hosting + Supabase + FCM）
- **インフラに時間をかけたくないチーム** → Option C（Render + Vercel + Supabase + FCM）

DBは両オプションとも **Supabase** が最適（無料・管理UI充実・設定が容易）。
プッシュ通知はどのオプションでも **FCM** が唯一の現実的選択肢。

---

## 6. 意思決定チェックリスト

以下の項目を確定させてから Phase 1 に着手する。

- [ ] デプロイ先（APIサーバー）を確定する
  - 候補: GCP Cloud Run / Render / Railway / fly.io
- [ ] フロントエンドホスティングを確定する
  - 候補: Firebase Hosting / Vercel / Netlify
- [ ] DBホスティングを確定する
  - 候補: Supabase（推奨）/ Neon / Railway PostgreSQL
- [ ] プッシュ通知サービスを確定する
  - 候補: FCM（推奨）

---

## 参考リンク

- [GCP Cloud Run 公式ドキュメント](https://cloud.google.com/run/docs)
- [Firebase Hosting 公式ドキュメント](https://firebase.google.com/docs/hosting)
- [Supabase 公式ドキュメント](https://supabase.com/docs)
- [Neon 公式ドキュメント](https://neon.tech/docs)
- [Railway 公式ドキュメント](https://docs.railway.app)
- [Render 公式ドキュメント](https://render.com/docs)
- [fly.io 公式ドキュメント](https://fly.io/docs)
- [FCM 公式ドキュメント](https://firebase.google.com/docs/cloud-messaging)
- [Vercel 公式ドキュメント](https://vercel.com/docs)
